[tox]
requires =
    tox>=4.2
    tox-gh-actions
    tox-uv>=1.20.2

envlist = d{41,50}-py{312}, pkg_meta, lint
;skip_missing_interpreters = true
isolated_build = True

[testenv]
passenv =
    DATABASE_URL
    STATIC_URL
    STATIC_ROOT
    CACHE_DEFAULT

setenv =
    PYTHONPATH =
    AUTHENTICATION_BACKENDS =
    CRYPTOGRAPHY_DONT_BUILD_RUST = 1
    SECRET_KEY = versy-super-secret-test-key
    DJANGO_SETTINGS_MODULE=aurora.config.settings
commands =
    pytest tests
dependency_groups = dev

[testenv:lint]
description = run static analysis and style check using ruff
skip_install = true
deps =
    pre-commit-uv>=4.1.1
pass_env =
    HOMEPATH
    PROGRAMDATA
commands =
    pre-commit run --all-files --show-diff-on-failure


[testenv:pkg_meta]
description = check that the long description is valid
skip_install = true
deps =
    check-wheel-contents>=0.6
    twine>=5.1.1
    uv>=0.5
commands =
    uv build --sdist --wheel --out-dir {env_tmp_dir} .
    twine check {env_tmp_dir}{/}*
    check-wheel-contents {env_tmp_dir}
